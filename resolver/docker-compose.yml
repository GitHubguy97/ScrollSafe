version: '3.8'

services:
  deepscan-resolver:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: deepscan-resolver
    ports:
      - "5000:5000"
    volumes:
      - ./cookies:/app/cookies:ro
    environment:
      - YTDLP_COOKIES_FILE=/app/cookies/www_youtube.com_cookies.txt
      - INFER_API_URL=${INFER_API_URL:-https://chkwk82q35esq5v4.us-east-1.aws.endpoints.huggingface.cloud}
      - INFER_API_KEY=${INFER_API_KEY:-380efcff27965210532f15a4140a41ac4189f2edb931052cec66a3923ba353d4}
      - HUGGING_FACE_API_KEY=${HUGGING_FACE_API_KEY:-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}
    command: python deepscan_resolver.py
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    networks:
      - resolver-network

  doomscroller-resolver:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: doomscroller-resolver
    ports:
      - "5001:5001"
    volumes:
      - ./cookies:/app/cookies:ro
    environment:
      - YTDLP_COOKIES_FILE=/app/cookies/www_youtube.com_cookies.txt
      - INFER_API_URL=${INFER_API_URL:-https://chkwk82q35esq5v4.us-east-1.aws.endpoints.huggingface.cloud}
      - INFER_API_KEY=${INFER_API_KEY:-380efcff27965210532f15a4140a41ac4189f2edb931052cec66a3923ba353d4}
      - HUGGING_FACE_API_KEY=${HUGGING_FACE_API_KEY:-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}
    command: python doomscroller_resolver.py
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5001/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    networks:
      - resolver-network

networks:
  resolver-network:
    driver: bridge
